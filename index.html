<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Krezus - Planer Bud≈ºetu</title>
  
  <!-- Preconnect do Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Biblioteki zewnƒôtrzne -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  
  <!-- Style -->
  <link rel="stylesheet" href="/src/styles/main.css">
  
  <style>
    /* Dodatkowe style dla powiadomie≈Ñ */
    .notification-btn {
      position: relative;
    }
    
    .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* Animacja migania dla zaktualizowanych element√≥w */
    @keyframes flash-update {
      0%, 100% { background-color: transparent; }
      50% { background-color: rgba(255, 229, 100, 0.5); }
    }
    
    .flash-update {
      animation: flash-update 1s ease-in-out 2;
    }
  </style>
</head>
<body>
  <!-- Kontener uwierzytelniania (widoczny tylko gdy u≈ºytkownik nie jest zalogowany) -->
  <div id="authContainer" class="auth-container" style="display: none;">
    <h2 id="authTitle">Logowanie</h2>
    <form id="authForm">
      <div class="form-group">
        <label for="authEmail">Email</label>
        <input 
          type="email" 
          id="authEmail" 
          required
          aria-label="Adres email"
          aria-required="true"
          placeholder="twoj@email.com"
        />
      </div>
      
      <div class="form-group">
        <label for="authPassword">Has≈Ço</label>
        <input 
          type="password" 
          id="authPassword" 
          required
          minlength="6"
          aria-label="Has≈Ço u≈ºytkownika"
          aria-required="true"
          placeholder="Minimum 6 znak√≥w"
        />
      </div>
      
      <button 
        type="submit" 
        id="authSubmit"
        aria-label="Zaloguj siƒô do aplikacji"
      >
        üîê Zaloguj siƒô
      </button>
    </form>
    
    <div class="auth-toggle">
      <p>
        <span id="authToggleText">Nie masz konta?</span>
        <a href="#" id="authToggleLink">Zarejestruj siƒô</a>
      </p>
    </div>
  </div>

  <!-- Kontener g≈Ç√≥wnej aplikacji (widoczny tylko po zalogowaniu) -->
  <div id="appContainer" style="display: none;">
    <header>Krezus</header>
    
    <!-- Informacje o u≈ºytkowniku -->
    <div class="user-info">
      <div>
        <span>Zalogowano jako: </span>
        <span class="user-name user-display-name"></span>
      </div>
      <div class="user-actions">
        <button 
          id="messagesBtn" 
          class="btn-secondary notification-btn"
          aria-label="Wiadomo≈õci"
          style="position: relative;"
        >
          üíå Wiadomo≈õci
          <span id="messagesBadge" class="notification-badge" style="display: none;">0</span>
        </button>
        <button 
          id="editProfileBtn" 
          class="btn-secondary"
          aria-label="Edytuj profil u≈ºytkownika"
        >
          üë§ Edytuj profil
        </button>
        <button 
          id="logoutBtn" 
          class="btn-secondary"
          aria-label="Wyloguj siƒô z aplikacji"
        >
          üö™ Wyloguj
        </button>
      </div>
    </div>
    
    <!-- Loader (wy≈õwietlany podczas ≈Çadowania danych) -->
    <div id="loader" class="loader-overlay">
      <div class="spinner"></div>
    </div>
    
    <!-- Nawigacja -->
    <nav class="navbar" role="navigation" aria-label="G≈Ç√≥wna nawigacja">
      <a href="#summary-section">Podsumowanie</a>
      <a href="#add-expense">Dodaj wydatek</a>
      <a href="#category-chart">Wykres</a>
      <a href="#comparisons">Por√≥wnania</a>
      <a href="#set-end-date">Ustaw koniec</a>
      <a href="#saving-goal">Cel oszczƒôdno≈õci</a>
      <a href="#categories">Kategorie</a>
      <a href="#sources">≈πr√≥d≈Ça finans√≥w</a>
      <a href="#income-history">Historia ≈∫r√≥de≈Ç finans√≥w</a>
      <a href="#expense-history">Historia wydatk√≥w</a>
    </nav>

    <main>
      <!-- Podsumowanie -->
      <section id="summary-section" class="section">
        <h2>üìä Podsumowanie</h2>
        <div id="summary"></div>
        <div id="anomalyMessage" style="margin-top:15px;padding:10px;border:1px solid #c0392b;background-color:#ffe6e6;color:#c0392b;display:none;border-radius:5px;"></div>
        
        <!-- Prognozowane limity -->
        <div id="forecastSummaryContainer" style="margin-top:20px;">
          <h3 id="forecastSummaryHeader" style="margin-bottom:10px; font-size:1.1rem; color: var(--primary); display:flex; align-items:center; gap:8px;">
            üîÆ Prognozowane limity
          </h3>
          <div id="forecastSummary" class="summary-items"></div>
        </div>
        
        <!-- Wska≈∫nik tempa wydatk√≥w -->
        <div id="spendingGaugeContainer"></div>
      </section>

      <!-- ≈πr√≥d≈Ça finans√≥w -->
      <section id="sources" class="section">
        <h2>üíº ≈πr√≥d≈Ça finans√≥w</h2>
        <div id="sourcesSummary">
          <p style="font-size:1.1rem; margin-bottom:8px;">
            <strong>Dostƒôpne ≈õrodki:</strong> <span id="availableFunds">0.00</span> PLN
          </p>
          <p style="font-size:0.95rem; margin-bottom:15px;">
            <strong>Data ostatniego dodania ≈õrodk√≥w:</strong> <span id="lastIncomeDate">Brak</span>
          </p>
          
          <!-- Formularz edycji stanu (tylko admin) -->
          <div id="editFundsContainer" style="display:none; margin-bottom:15px;">
            <label for="editFundsAmount" style="font-weight:600;">Nowa kwota dostƒôpna (PLN):</label>
            <input 
              type="number" 
              id="editFundsAmount" 
              min="0" 
              step="0.01"
              aria-label="Nowa kwota dostƒôpnych ≈õrodk√≥w"
            />
            <div style="display:flex; gap:10px;">
              <button 
                type="button" 
                id="confirmEditFunds"
                aria-label="Zatwierd≈∫ edycjƒô stanu ≈õrodk√≥w"
              >
                Zatwierd≈∫
              </button>
              <button 
                type="button" 
                id="cancelEditFunds" 
                class="btn-secondary"
                aria-label="Anuluj edycjƒô stanu ≈õrodk√≥w"
              >
                Anuluj
              </button>
            </div>
          </div>
          
          <!-- Formularz dodawania ≈õrodk√≥w -->
          <div id="addFundsContainer" style="display:none; margin-bottom:15px;">
            <label for="addFundsAmount">Kwota (PLN):</label>
            <input 
              type="number" 
              id="addFundsAmount" 
              min="0" 
              step="0.01"
              required
              aria-label="Kwota nowych ≈õrodk√≥w"
              aria-required="true"
            />
            
            <label for="addFundsDesc">Opis:</label>
            <input 
              type="text" 
              id="addFundsDesc" 
              placeholder="Np. pensja, dodatkowy doch√≥d"
              aria-label="Opis ≈∫r√≥d≈Ça finans√≥w"
            />
            
            <label for="addFundsType">Typ:</label>
            <select id="addFundsType" aria-label="Typ transakcji">
              <option value="normal">Zwyk≈Çy</option>
              <option value="planned">Planowany</option>
            </select>
            
            <div id="addFundsDateContainer" style="display:none;">
              <label for="addFundsDate">Data:</label>
              <input 
                type="date" 
                id="addFundsDate"
                aria-label="Data planowanego wp≈Çywu"
              />
            </div>
            
            <div style="display:flex; gap:10px;">
              <button 
                type="button" 
                id="confirmAddFunds"
                aria-label="Zatwierd≈∫ dodanie ≈õrodk√≥w"
              >
                Zatwierd≈∫
              </button>
              <button 
                type="button" 
                id="cancelAddFunds" 
                class="btn-secondary"
                aria-label="Anuluj dodawanie ≈õrodk√≥w"
              >
                Anuluj
              </button>
            </div>
          </div>
          
          <!-- Przyciski akcji -->
          <div id="sourcesButtons" style="display:flex; gap:10px; flex-wrap:wrap;">
            <button 
              type="button" 
              id="showAddFundsForm"
              aria-label="Poka≈º formularz dodawania ≈õrodk√≥w"
            >
              ‚ûï Dodaj ≈õrodki
            </button>
            <button 
              type="button" 
              id="editFundsButton" 
              style="display:none;"
              aria-label="Edytuj stan dostƒôpnych ≈õrodk√≥w"
            >
              ‚úèÔ∏è Edytuj stan
            </button>
          </div>
        </div>
      </section>

      <!-- Historia ≈∫r√≥de≈Ç finans√≥w -->
      <section id="income-history" class="section">
        <h2>üïê Historia ≈∫r√≥de≈Ç finans√≥w</h2>
        <div style="overflow-x: auto;">
          <table id="incomeHistoryTable" class="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Godzina</th>
                <th>Opis</th>
                <th>Kwota (PLN)</th>
                <th>Akcja</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="incomePagination" class="pagination-controls"></div>
      </section>

      <!-- Dodaj wydatek -->
      <section id="add-expense" class="section">
        <h2>üõí Dodaj wydatek</h2>
        <form id="expenseForm">
          <label for="expenseDate">Data:</label>
          <input 
            type="date" 
            id="expenseDate" 
            required
            aria-label="Data wydatku"
            aria-required="true"
          />
          
          <label for="expenseCategory">Kategoria:</label>
          <input 
            list="categoryList" 
            id="expenseCategory" 
            required
            aria-label="Wybierz lub wpisz kategoriƒô"
            aria-required="true"
          />
          <datalist id="categoryList"></datalist>
          <div id="categorySuggestions" class="suggestions-container"></div>
          
          <label for="expenseQuantity">Ilo≈õƒá:</label>
          <input 
            type="number" 
            id="expenseQuantity" 
            min="1" 
            value="1" 
            required
            aria-label="Ilo≈õƒá"
            aria-required="true"
          />
          
          <label for="expenseAmount">Kwota (PLN):</label>
          <input 
            type="number" 
            id="expenseAmount" 
            min="0" 
            step="0.01" 
            required
            pattern="[0-9]+(\.[0-9]{1,2})?"
            aria-label="Kwota wydatku"
            aria-required="true"
          />
          
          <label for="expenseDesc">Opis:</label>
          <input 
            type="text" 
            id="expenseDesc" 
            placeholder="Np. zakupy spo≈ºywcze"
            aria-label="Opis wydatku"
          />
          <div id="descriptionSuggestions" class="suggestions-container"></div>
          
          <label for="expenseType">Typ:</label>
          <select id="expenseType" aria-label="Typ transakcji">
            <option value="normal">Zwyk≈Çy</option>
            <option value="planned">Planowany</option>
          </select>
          
          <button 
            type="submit"
            aria-label="Dodaj wydatek do bud≈ºetu"
          >
            ‚ûñ Dodaj wydatek
          </button>
        </form>
      </section>

      <!-- Wykres kategorii -->
      <section id="category-chart" class="section">
        <h2>üìà Udzia≈Ç kategorii w wydatkach</h2>
        <div class="category-controls" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:10px;">
          <label for="categoryMonthSelect">MiesiƒÖc:</label>
          <select 
            id="categoryMonthSelect" 
            style="min-width:160px;"
            aria-label="Wybierz miesiƒÖc do wy≈õwietlenia"
          ></select>
        </div>
        <canvas id="categoryChart" width="400" height="300"></canvas>
        <div id="chartLegend" class="chart-legend"></div>
      </section>

      <!-- Por√≥wnania -->
      <section id="comparisons" class="section">
        <h2>üìä Por√≥wnania</h2>
        <div class="comparison-controls" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:10px;">
          <label for="comparisonPeriod">Okres:</label>
          <select id="comparisonPeriod" aria-label="Wybierz okres por√≥wnania">
            <option value="weekly">Tygodniowo (4 tyg.)</option>
            <option value="monthly">Miesiƒôcznie (6 mies.)</option>
          </select>
        </div>
        <div style="height:400px;">
          <canvas id="comparisonsChart"></canvas>
        </div>
        <div id="comparisonsTable" style="overflow-x:auto;margin-top:15px;"></div>
      </section>

      <!-- Ustaw ko≈Ñce okresu bud≈ºetowego -->
      <section id="set-end-date" class="section">
        <h2>üìÜ Ustaw ko≈Ñce okresu bud≈ºetowego</h2>
        <form id="endDatesForm">
          <label for="budgetEndDate1">Data ko≈Ñcowa 1:</label>
          <input 
            type="date" 
            id="budgetEndDate1" 
            required 
            disabled
            aria-label="Pierwsza data ko≈Ñcowa okresu bud≈ºetowego"
          />
          
          <label for="budgetEndDate2">Data ko≈Ñcowa 2:</label>
          <input 
            type="date" 
            id="budgetEndDate2" 
            required 
            disabled
            aria-label="Druga data ko≈Ñcowa okresu bud≈ºetowego"
          />
          
          <button 
            id="setEndDatesButton" 
            type="submit" 
            disabled
            aria-label="Ustaw daty ko≈Ñcowe okres√≥w bud≈ºetowych"
          >
            üìÖ Ustaw daty ko≈Ñcowe
          </button>
        </form>
      </section>

      <!-- Ustaw cel oszczƒôdno≈õci -->
      <section id="saving-goal" class="section">
        <h2>üèñ Ustaw cel oszczƒôdno≈õci</h2>
        <form id="savingGoalForm">
          <label for="savingGoal">Kwota do oszczƒôdzenia (PLN):</label>
          <input 
            type="number" 
            id="savingGoal" 
            min="0" 
            step="0.01"
            pattern="[0-9]+(\.[0-9]{1,2})?"
            aria-label="Kwota celu oszczƒôdno≈õci"
          />
          <button 
            type="submit"
            aria-label="Ustaw cel oszczƒôdno≈õci"
          >
            üí∞ Ustaw cel
          </button>
        </form>
      </section>

      <!-- Twoje kategorie -->
      <section id="categories" class="section">
        <h2>üìÇ Twoje kategorie</h2>
        <div id="categoriesSection">
          <div style="overflow-x: auto;">
            <table id="categoriesTable">
              <thead>
                <tr>
                  <th>Kategoria</th>
                  <th>Wydatki (PLN)</th>
                  <th>Edytuj</th>
                  <th>Usu≈Ñ</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Historia wydatk√≥w -->
      <section id="expense-history" class="section">
        <h2>üßæ Historia wydatk√≥w</h2>
        <div style="overflow-x: auto;">
          <table id="historyTable" class="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Godzina</th>
                <th>Kategoria</th>
                <th>Opis</th>
                <th>Ilo≈õƒá</th>
                <th>Kwota (PLN)</th>
                <th>Edytuj</th>
                <th>Usu≈Ñ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="expensePagination" class="pagination-controls"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer-info">
      <p>Autor: S≈Çawomir Sprawski | Wersja 2.0</p>
    </footer>
  </div>

  <!-- G≈Ç√≥wny skrypt aplikacji (modu≈Ç ES6) -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>