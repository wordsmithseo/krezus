<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krezus - Inteligentny Bud≈ºet Osobisty</title>
    <link rel="stylesheet" href="src/styles/main.css">
</head>
<body>
    <!-- LOADER -->
    <div id="appLoader" class="app-loader">
        <div class="loader-spinner"></div>
        <p>≈Åadowanie...</p>
    </div>

    <!-- SEKCJA LOGOWANIA -->
    <div id="authSection" class="auth-container hidden">
        <h1 class="text-center" style="color: var(--primary); margin-bottom: 30px;">Krezus üí∞</h1>
        
        <div class="auth-tabs">
            <button class="tab-btn active" onclick="showAuthTab('login')">Logowanie</button>
            <button class="tab-btn" onclick="showAuthTab('register')">Rejestracja</button>
        </div>

        <div id="loginTab" class="tab-content active">
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Has≈Ço</label>
                    <input type="password" name="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Zaloguj siƒô</button>
            </form>
        </div>

        <div id="registerTab" class="tab-content">
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label>Nazwa u≈ºytkownika</label>
                    <input type="text" name="registerDisplayName" required minlength="2">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="registerEmail" required>
                </div>
                <div class="form-group">
                    <label>Has≈Ço (min. 6 znak√≥w)</label>
                    <input type="password" name="registerPassword" required minlength="6">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Zarejestruj siƒô</button>
            </form>
        </div>
    </div>

    <div id="appSection" class="hidden">
        <header class="app-header">
            <div class="header-content">
                <div class="app-title">
                    <h1>Krezus</h1>
                    <span id="appVersion" class="app-version"></span>
                </div>
                <div class="header-user">
                    <div class="user-info">
                        <span id="username"></span>
                    </div>
                    <button id="profileBtn" class="btn-profile" onclick="openProfile()">üë§ Profil</button>
                    <button class="btn-logout" onclick="handleLogout()">Wyloguj</button>
                </div>
            </div>
        </header>

        <nav class="app-nav">
            <div class="nav-container">
                <div class="nav-menu">
                    <button class="nav-btn active" onclick="showSection('summarySection')">üìä Podsumowanie</button>
                    <button class="nav-btn" onclick="showSection('envelopeSection')">üì© Koperta dnia</button>
                    <button class="nav-btn" onclick="showSection('sourcesSection')">üí∞ Przychody</button>
                    <button class="nav-btn" onclick="showSection('expensesSection')">üí∏ Wydatki</button>
                    <button class="nav-btn" onclick="showSection('categoriesSection')">üè∑Ô∏è Kategorie</button>
                    <button class="nav-btn" onclick="showSection('analyticsSection')">üìà Analityka</button>
                    <button class="nav-btn" onclick="showSection('settingsSection')">‚öôÔ∏è Ustawienia</button>
                </div>
            </div>
        </nav>

        <div class="container">
            <section id="summarySection" class="section active">
                <div class="section-card">
                    <h2>üí∞ Podsumowanie bud≈ºetu</h2>
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-label">Dostƒôpne ≈õrodki</div>
                            <div class="stat-value"><span id="availableFunds">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Cel oszczƒôdno≈õci (rezerwa)</div>
                            <div class="stat-value"><span id="savingGoal">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Do wydania</div>
                            <div class="stat-value"><span id="toSpend">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                    </div>
                    
                    <h3>üìÖ Wydatki w okresach</h3>
                    <div class="stats-grid">
                        <div class="stat-card danger">
                            <div class="stat-label">Wydano dzi≈õ</div>
                            <div class="stat-value"><span id="todayExpenses">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Wydano w tym tygodniu</div>
                            <div class="stat-value"><span id="weekExpenses">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Wydano w tym miesiƒÖcu</div>
                            <div class="stat-value"><span id="monthExpenses">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                    </div>
                    
                    <h3>üìä Limity bie≈ºƒÖce (bez planowanych)</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Limit dzienny (do <span id="currentLimitDate1">-</span>)</div>
                            <div class="stat-value"><span id="currentLimit1">0.00</span><span class="stat-unit">z≈Ç/dzie≈Ñ</span></div>
                            <div class="stat-label mt-10">Pozosta≈Ço <span id="currentDaysLeft1">0</span> dni</div>
                        </div>
                        <div id="currentLimit2Section" class="stat-card" style="display: none;">
                            <div class="stat-label">Limit dzienny (do <span id="currentLimitDate2">-</span>)</div>
                            <div class="stat-value"><span id="currentLimit2">0.00</span><span class="stat-unit">z≈Ç/dzie≈Ñ</span></div>
                            <div class="stat-label mt-10">Pozosta≈Ço <span id="currentDaysLeft2">0</span> dni</div>
                        </div>
                    </div>
                    
                    <h3>üîÆ Prognozy (z planowanymi)</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Prognozowane dostƒôpne ≈õrodki</div>
                            <div class="stat-value"><span id="projectedAvailable">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Prognozowany limit (do <span id="projectedLimitDate1">-</span>)</div>
                            <div class="stat-value"><span id="projectedLimit1">0.00</span><span class="stat-unit">z≈Ç/dzie≈Ñ</span></div>
                            <div class="stat-label mt-10">Pozosta≈Ço <span id="daysLeft1">0</span> dni</div>
                        </div>
                        <div id="projectedLimit2Section" class="stat-card" style="display: none;">
                            <div class="stat-label">Prognozowany limit (do <span id="projectedLimitDate2">-</span>)</div>
                            <div class="stat-value"><span id="projectedLimit2">0.00</span><span class="stat-unit">z≈Ç/dzie≈Ñ</span></div>
                            <div class="stat-label mt-10">Pozosta≈Ço <span id="daysLeft2">0</span> dni</div>
                        </div>
                    </div>
                    <h3>üìä Planowane transakcje</h3>
                    <div class="stats-grid">
                        <div class="stat-card success">
                            <div class="stat-label">Planowane przychody</div>
                            <div class="stat-value"><span id="futureIncome">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card danger">
                            <div class="stat-label">Planowane wydatki</div>
                            <div class="stat-value"><span id="futureExpense">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                    </div>
                    
                    <h3>üéØ Dynamika wydatk√≥w</h3>
                    <div id="dynamicsInfo" class="spending-dynamics"></div>
                </div>
            </section>

            <section id="envelopeSection" class="section">
                <div class="section-card">
                    <h2>üì© Koperta dnia</h2>
                    <div class="envelope-container">
                        <div class="stat-label">Koperta dnia:</div>
                        <div class="envelope-amount"><span id="envelopeAmount">0.00</span> z≈Ç</div>
                        <div id="envelopeCalculationInfo" style="margin-top: 10px; margin-bottom: 15px;"></div>
                        <div class="spending-gauge">
                            <div id="spendingGauge" class="gauge-fill" style="width: 0%"></div>
                        </div>
                        <div class="envelope-details">
                            <div><strong>Wydano:</strong> <span id="envelopeSpent">0.00</span> z≈Ç</div>
                            <div><strong>Pozosta≈Ço:</strong> <span id="envelopeRemaining">0.00</span> z≈Ç</div>
                        </div>
                        <div class="envelope-median"><strong>Mediana wydatk√≥w (30 dni):</strong> <span id="envelopeMedian">0.00</span> z≈Ç</div>
                    </div>
                </div>
            </section>

            <section id="sourcesSection" class="section">
                <div class="section-card">
                    <h2 id="incomeFormTitle">üí∞ Dodaj przych√≥d</h2>
                    <form id="incomeForm" onsubmit="addIncome(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kwota (z≈Ç)</label>
                                <input type="number" name="incomeAmount" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Typ transakcji</label>
                                <select id="incomeType" name="incomeType" required>
                                    <option value="normal">Zwyk≈Çy</option>
                                    <option value="planned">Planowany</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data</label>
                                <input type="date" id="incomeDate" name="incomeDate" required>
                            </div>
                            <div class="form-group">
                                <label>Godzina (opcjonalnie)</label>
                                <input type="time" id="incomeTime" name="incomeTime">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>U≈ºytkownik</label>
                                <select id="incomeUser" name="incomeUser" required>
                                    <option value="">Wybierz u≈ºytkownika</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>≈πr√≥d≈Ço</label>
                                <input type="text" id="incomeSource" name="incomeSource" placeholder="np. Wynagrodzenie" autocomplete="off">
                                <div id="sourceButtons" class="top-sources-buttons"></div>
                                <div id="sourceSuggestions" class="suggestions-container"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-20">Zapisz przych√≥d</button>
                    </form>
                </div>
                
                <div class="section-card">
                    <h2>üîß Korekta posiadanych ≈õrodk√≥w</h2>
                    <p style="margin-bottom: 15px; color: var(--gray);">
                        Aktualne dostƒôpne ≈õrodki: <strong><span id="currentFundsDisplay">0.00</span> z≈Ç</strong>
                    </p>
                    <form id="correctionForm" onsubmit="addCorrection(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nowa kwota ca≈Çkowitych ≈õrodk√≥w (z≈Ç)</label>
                                <input type="number" name="correctionAmount" step="0.01" required placeholder="np. 5000.00">
                                <small class="text-muted">Wprowad≈∫ jakƒÖ kwotƒô ≈õrodk√≥w CHCESZ mieƒá po korekcie</small>
                            </div>
                            <div class="form-group">
                                <label>Pow√≥d korekty</label>
                                <input type="text" name="correctionReason" required placeholder="np. B≈ÇƒÖd w rozliczeniu, Korekta bankowa">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-warning mt-20">Wprowad≈∫ korektƒô</button>
                    </form>
                </div>
                
                <div class="section-card">
                    <h3>üìã Historia przychod√≥w</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th><th>Godzina</th><th>Kwota</th><th>U≈ºytkownik</th><th>≈πr√≥d≈Ço</th><th>Typ</th><th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="sourcesTableBody">
                                <tr><td colspan="7" class="empty-state">Brak przychod√≥w</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-container"><div id="incomesPagination"></div></div>
                </div>
            </section>

            <section id="expensesSection" class="section">
                <div class="section-card">
                    <h2 id="expenseFormTitle">üí∏ Dodaj wydatek</h2>
                    <form id="expenseForm" onsubmit="addExpense(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kwota (z≈Ç)</label>
                                <input type="number" name="expenseAmount" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label>Typ transakcji</label>
                                <select id="expenseType" name="expenseType" required>
                                    <option value="normal">Zwyk≈Çy</option>
                                    <option value="planned">Planowany</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data</label>
                                <input type="date" id="expenseDate" name="expenseDate" required>
                            </div>
                            <div class="form-group">
                                <label>Godzina (opcjonalnie)</label>
                                <input type="time" id="expenseTime" name="expenseTime">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>U≈ºytkownik</label>
                                <select id="expenseUser" name="expenseUser" required>
                                    <option value="">Wybierz u≈ºytkownika</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Kategoria</label>
                                <input type="text" id="expenseCategory" name="expenseCategory" required autocomplete="off">
                                <div id="categoryButtons" class="top-categories-buttons"></div>
                                <div id="categorySuggestions" class="suggestions-container"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Opis</label>
                            <input type="text" id="expenseDescription" name="expenseDescription" required autocomplete="off">
                            <div id="descriptionButtons" class="top-categories-buttons"></div>
                            <div id="descriptionSuggestions" class="suggestions-container"></div>
                        </div>
                        <button type="submit" class="btn btn-primary mt-20">Zapisz wydatek</button>
                    </form>
                </div>
                <div class="section-card">
                    <h3>üìã Historia wydatk√≥w</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th><th>Godzina</th><th>Kwota</th><th>U≈ºytkownik</th><th>Kategoria</th><th>Opis</th><th>Typ</th><th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <tr><td colspan="8" class="empty-state">Brak wydatk√≥w</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination-container"><div id="expensesPagination"></div></div>
                </div>
            </section>

            <section id="categoriesSection" class="section">
                <div class="section-card">
                    <h2>üè∑Ô∏è ZarzƒÖdzaj kategoriami</h2>
                    <div class="form-group">
                        <label>Nowa kategoria</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="newCategoryName" placeholder="Nazwa kategorii" style="flex: 1;">
                            <button class="btn btn-success" onclick="addCategory()">Dodaj</button>
                        </div>
                    </div>
                    <div class="mt-20">
                        <h3>üìã Lista kategorii</h3>
                        <div id="categoriesList"></div>
                    </div>
                </div>
            </section>

            <section id="analyticsSection" class="section">
                <div class="section-card">
                    <h2>üìà Analiza wydatk√≥w</h2>
                    <div class="analytics-controls">
                        <div class="form-group">
                            <label>Wybierz okres</label>
                            <div class="period-buttons">
                                <button class="period-btn active" onclick="selectPeriod(7)">7 dni</button>
                                <button class="period-btn" onclick="selectPeriod(14)">14 dni</button>
                                <button class="period-btn" onclick="selectPeriod(30)">30 dni</button>
                                <button class="period-btn" onclick="selectPeriod(90)">90 dni</button>
                                <button class="period-btn" onclick="selectPeriod('custom')">W≈Çasny</button>
                            </div>
                        </div>
                        <div id="customPeriodInputs" class="custom-period" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Data od</label>
                                    <input type="date" id="analyticsDateFrom">
                                </div>
                                <div class="form-group">
                                    <label>Data do</label>
                                    <input type="date" id="analyticsDateTo">
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button class="btn btn-primary" onclick="applyCustomPeriod()">Zastosuj</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h3>üìä Podsumowanie okresu</h3>
                    <div class="stats-grid">
                        <div class="stat-card danger">
                            <div class="stat-label">Wydatki w okresie</div>
                            <div class="stat-value"><span id="periodExpenses">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Przychody w okresie</div>
                            <div class="stat-value"><span id="periodIncomes">0.00</span><span class="stat-unit">z≈Ç</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Liczba wydatk√≥w</div>
                            <div class="stat-value"><span id="periodExpensesCount">0</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Liczba przychod√≥w</div>
                            <div class="stat-value"><span id="periodIncomesCount">0</span></div>
                        </div>
                    </div>
                    <h3>üîÑ Por√≥wnanie z poprzednim okresem</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Zmiana wydatk√≥w</div>
                            <div class="stat-value stat-value-white"><span id="expenseChange">0.0%</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Zmiana przychod√≥w</div>
                            <div class="stat-value stat-value-white"><span id="incomeChange">0.0%</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Zmiana liczby wydatk√≥w</div>
                            <div class="stat-value stat-value-white"><span id="expenseCountChange">0.0%</span></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Zmiana liczby przychod√≥w</div>
                            <div class="stat-value stat-value-white"><span id="incomeCountChange">0.0%</span></div>
                        </div>
                    </div>
                    <h3>üë• Wydatki u≈ºytkownik√≥w</h3>
                    <div id="userExpensesBreakdown"></div>
                    <h3>üèÜ Top 3 najkosztowniejszych kategorii</h3>
                    <div id="mostExpensiveCategory"></div>
                    <h3>üìä Udzia≈Ç kategorii w wydatkach</h3>
                    <canvas id="categoriesChart" width="800" height="400" style="max-width: 100%; margin: 20px 0;"></canvas>
                    <h3>‚ö†Ô∏è Wykryte anomalie</h3>
                    <div id="anomaliesList"></div>
                </div>
            </section>

            <section id="settingsSection" class="section">
                <div class="section-card">
                    <h2>‚öôÔ∏è Ustawienia bud≈ºetu</h2>
                    <form id="settingsForm" onsubmit="saveSettings(event)">
                        <div class="form-group">
                            <label>Data ko≈Ñcowa okresu 1 (g≈Ç√≥wny okres)</label>
                            <input type="date" id="settingsEndDate1" name="endDate1" required>
                        </div>
                        <div class="form-group">
                            <label>Data ko≈Ñcowa okresu 2 (opcjonalnie)</label>
                            <input type="date" id="settingsEndDate2" name="endDate2">
                            <small class="text-muted">Pozostaw puste je≈õli chcesz u≈ºywaƒá tylko jednego okresu</small>
                        </div>
                        <div class="form-group">
                            <label>Cel oszczƒôdno≈õci / Rezerwa (z≈Ç)</label>
                            <input type="number" id="settingsSavingGoal" name="savingGoal" step="0.01" min="0" value="0">
                            <small class="text-muted">Kwota kt√≥ra zostanie odjƒôta od dostƒôpnych ≈õrodk√≥w</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Zapisz ustawienia</button>
                    </form>
                </div>
                
                <div class="section-card">
                    <h2>üìú Logi systemu</h2>
                    <div class="logs-info">
                        <p><strong>Rozmiar log√≥w:</strong> <span id="logsSize">0 KB</span></p>
                        <p><strong>Liczba wpis√≥w:</strong> <span id="logsCount">0</span></p>
                    </div>
                    <button class="btn btn-danger mt-20" onclick="clearLogs()">üóëÔ∏è Wyczy≈õƒá logi</button>
                    <div class="mt-20">
                        <h3>üìã Ostatnie wpisy (maksymalnie 50)</h3>
                        <div id="logsList" class="logs-list"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script type="module" src="src/app.js"></script>
    <script>
        function showAuthTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            if (tab === 'login') {
                document.querySelector('.tab-btn:first-child').classList.add('active');
                document.getElementById('loginTab').classList.add('active');
            } else {
                document.querySelector('.tab-btn:last-child').classList.add('active');
                document.getElementById('registerTab').classList.add('active');
            }
        }
        
        setInterval(() => {
            const fundsDisplay = document.getElementById('currentFundsDisplay');
            const availableFunds = document.getElementById('availableFunds');
            if (fundsDisplay && availableFunds) {
                fundsDisplay.textContent = availableFunds.textContent;
            }
        }, 1000);
    </script>
</body>
</html>