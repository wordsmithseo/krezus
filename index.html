<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Krezus - Planer BudÅ¼etu</title>
  
  <!-- Preconnect do Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Biblioteki zewnÄ™trzne -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  
  <!-- Style -->
  <link rel="stylesheet" href="/src/styles/main.css">
  
  <style>
    /* Dodatkowe style dla powiadomieÅ„ */
    .notification-btn {
      position: relative;
    }
    
    .notification-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    /* Animacja migania dla zaktualizowanych elementÃ³w */
    @keyframes flash-update {
      0%, 100% { background-color: transparent; }
      50% { background-color: rgba(255, 229, 100, 0.5); }
    }
    
    .flash-update {
      animation: flash-update 1s ease-in-out 2;
    }
  </style>
</head>
<body>
  <!-- Kontener uwierzytelniania (widoczny tylko gdy uÅ¼ytkownik nie jest zalogowany) -->
  <div id="authContainer" class="auth-container" style="display: none;">
    <h2 id="authTitle">Logowanie</h2>
    <form id="authForm">
      <div class="form-group">
        <label for="authEmail">Email</label>
        <input 
          type="email" 
          id="authEmail" 
          required
          aria-label="Adres email"
          aria-required="true"
          placeholder="twoj@email.com"
        />
      </div>
      
      <div class="form-group">
        <label for="authPassword">HasÅ‚o</label>
        <input 
          type="password" 
          id="authPassword" 
          required
          minlength="6"
          aria-label="HasÅ‚o uÅ¼ytkownika"
          aria-required="true"
          placeholder="Minimum 6 znakÃ³w"
        />
      </div>
      
      <button 
        type="submit" 
        id="authSubmit"
        aria-label="Zaloguj siÄ™ do aplikacji"
      >
        ğŸ” Zaloguj siÄ™
      </button>
    </form>
    
    <div class="auth-toggle">
      <p>
        <span id="authToggleText">Nie masz konta?</span>
        <a href="#" id="authToggleLink">Zarejestruj siÄ™</a>
      </p>
    </div>
  </div>

  <!-- Kontener gÅ‚Ã³wnej aplikacji (widoczny tylko po zalogowaniu) -->
  <div id="appContainer" style="display: none;">
    <header>Krezus</header>
    
    <!-- Informacje o uÅ¼ytkowniku -->
    <div class="user-info">
      <div>
        <span>Zalogowano jako: </span>
        <span class="user-name user-display-name"></span>
      </div>
      <div class="user-actions">
        <button 
          id="messagesBtn" 
          class="btn-secondary notification-btn"
          aria-label="WiadomoÅ›ci"
          style="position: relative;"
        >
          ğŸ’Œ WiadomoÅ›ci
          <span id="messagesBadge" class="notification-badge" style="display: none;">0</span>
        </button>
        <button 
          id="editProfileBtn" 
          class="btn-secondary"
          aria-label="Edytuj profil uÅ¼ytkownika"
        >
          ğŸ‘¤ Edytuj profil
        </button>
        <button 
          id="logoutBtn" 
          class="btn-secondary"
          aria-label="Wyloguj siÄ™ z aplikacji"
        >
          ğŸšª Wyloguj
        </button>
      </div>
    </div>
    
    <!-- Loader (wyÅ›wietlany podczas Å‚adowania danych) -->
    <div id="loader" class="loader-overlay">
      <div class="spinner"></div>
    </div>
    
    <!-- NOWA NAWIGACJA - Lepsze nazwy i organizacja -->
    <nav class="navbar" role="navigation" aria-label="GÅ‚Ã³wna nawigacja">
      <div class="nav-section">
        <span class="nav-section-title">ğŸ“Š PrzeglÄ…d</span>
        <a href="#summary-section">Podsumowanie budÅ¼etu</a>
        <a href="#category-chart">Wykres kategorii</a>
        <a href="#comparisons">PorÃ³wnanie okresÃ³w</a>
      </div>
      
      <div class="nav-section">
        <span class="nav-section-title">ğŸ’° Finanse</span>
        <a href="#sources">Å¹rÃ³dÅ‚a finansÃ³w</a>
        <a href="#income-history">Historia przychodÃ³w</a>
      </div>
      
      <div class="nav-section">
        <span class="nav-section-title">ğŸ’¸ Wydatki</span>
        <a href="#add-expense">Dodaj wydatek</a>
        <a href="#expense-history">Historia wydatkÃ³w</a>
        <a href="#categories">ZarzÄ…dzaj kategoriami</a>
      </div>
      
      <div class="nav-section">
        <span class="nav-section-title">âš™ï¸ Ustawienia</span>
        <a href="#set-end-date">Okresy budÅ¼etowe</a>
        <a href="#saving-goal">Cel oszczÄ™dnoÅ›ci</a>
      </div>
    </nav>

    <main>
      <!-- Podsumowanie -->
      <section id="summary-section" class="section">
        <h2>ğŸ“Š Podsumowanie budÅ¼etu</h2>
        <div id="summary"></div>
        <div id="anomalyMessage" style="margin-top:15px;padding:10px;border:1px solid #c0392b;background-color:#ffe6e6;color:#c0392b;display:none;border-radius:5px;"></div>
        
        <!-- Prognozowane limity -->
        <div id="forecastSummaryContainer" style="margin-top:20px;">
          <h3 id="forecastSummaryHeader" style="margin-bottom:10px; font-size:1.1rem; color: var(--primary); display:flex; align-items:center; gap:8px;">
            ğŸ”® Prognozowane limity
          </h3>
          <div id="forecastSummary" class="summary-items"></div>
        </div>
        
        <!-- WskaÅºnik tempa wydatkÃ³w -->
        <div id="spendingGaugeContainer"></div>
      </section>

      <!-- Å¹rÃ³dÅ‚a finansÃ³w -->
      <section id="sources" class="section">
        <h2>ğŸ’¼ Å¹rÃ³dÅ‚a finansÃ³w</h2>
        <div id="sourcesSummary">
          <p style="font-size:1.1rem; margin-bottom:8px;">
            <strong>DostÄ™pne Å›rodki:</strong> <span id="availableFunds">0.00</span> PLN
          </p>
          <p style="font-size:0.95rem; margin-bottom:15px;">
            <strong>Data ostatniego dodania Å›rodkÃ³w:</strong> <span id="lastIncomeDate">Brak</span>
          </p>
          
          <!-- Formularz edycji stanu (tylko admin) -->
          <div id="editFundsContainer" style="display:none; margin-bottom:15px;">
            <label for="editFundsAmount" style="font-weight:600;">Nowa kwota dostÄ™pna (PLN):</label>
            <input 
              type="number" 
              id="editFundsAmount" 
              min="0" 
              step="0.01"
              aria-label="Nowa kwota dostÄ™pnych Å›rodkÃ³w"
            />
            <div style="display:flex; gap:10px;">
              <button 
                type="button" 
                id="confirmEditFunds"
                aria-label="ZatwierdÅº edycjÄ™ stanu Å›rodkÃ³w"
              >
                ZatwierdÅº
              </button>
              <button 
                type="button" 
                id="cancelEditFunds" 
                class="btn-secondary"
                aria-label="Anuluj edycjÄ™ stanu Å›rodkÃ³w"
              >
                Anuluj
              </button>
            </div>
          </div>
          
          <!-- Formularz dodawania Å›rodkÃ³w -->
          <div id="addFundsContainer" style="display:none; margin-bottom:15px;">
            <label for="addFundsAmount">Kwota (PLN):</label>
            <input 
              type="number" 
              id="addFundsAmount" 
              min="0" 
              step="0.01"
              required
              aria-label="Kwota nowych Å›rodkÃ³w"
              aria-required="true"
            />
            
            <label for="addFundsDesc">Opis:</label>
            <input 
              type="text" 
              id="addFundsDesc" 
              placeholder="Np. pensja, dodatkowy dochÃ³d"
              aria-label="Opis ÅºrÃ³dÅ‚a finansÃ³w"
            />
            
            <label for="addFundsType">Typ:</label>
            <select id="addFundsType" aria-label="Typ transakcji">
              <option value="normal">ZwykÅ‚y</option>
              <option value="planned">Planowany</option>
            </select>
            
            <div id="addFundsDateContainer" style="display:none;">
              <label for="addFundsDate">Data:</label>
              <input 
                type="date" 
                id="addFundsDate"
                aria-label="Data planowanego wpÅ‚ywu"
              />
            </div>
            
            <div style="display:flex; gap:10px;">
              <button 
                type="button" 
                id="confirmAddFunds"
                aria-label="ZatwierdÅº dodanie Å›rodkÃ³w"
              >
                ZatwierdÅº
              </button>
              <button 
                type="button" 
                id="cancelAddFunds" 
                class="btn-secondary"
                aria-label="Anuluj dodawanie Å›rodkÃ³w"
              >
                Anuluj
              </button>
            </div>
          </div>
          
          <!-- Przyciski akcji -->
          <div id="sourcesButtons" style="display:flex; gap:10px; flex-wrap:wrap;">
            <button 
              type="button" 
              id="showAddFundsForm"
              aria-label="PokaÅ¼ formularz dodawania Å›rodkÃ³w"
            >
              â• Dodaj Å›rodki
            </button>
            <button 
              type="button" 
              id="editFundsButton" 
              style="display:none;"
              aria-label="Edytuj stan dostÄ™pnych Å›rodkÃ³w"
            >
              âœï¸ Edytuj stan
            </button>
          </div>
        </div>
      </section>

      <!-- Historia ÅºrÃ³deÅ‚ finansÃ³w -->
      <section id="income-history" class="section">
        <h2>ğŸ• Historia przychodÃ³w</h2>
        <div style="overflow-x: auto;">
          <table id="incomeHistoryTable" class="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Godzina</th>
                <th>Opis</th>
                <th>Kwota (PLN)</th>
                <th>Akcja</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="incomePagination" class="pagination-controls"></div>
      </section>

      <!-- Dodaj wydatek -->
      <section id="add-expense" class="section">
        <h2>ğŸ›’ Dodaj nowy wydatek</h2>
        <form id="expenseForm">
          <label for="expenseDate">Data:</label>
          <input 
            type="date" 
            id="expenseDate" 
            required
            aria-label="Data wydatku"
            aria-required="true"
          />
          
          <label for="expenseCategory">Kategoria:</label>
          <input 
            list="categoryList" 
            id="expenseCategory" 
            required
            aria-label="Wybierz lub wpisz kategoriÄ™"
            aria-required="true"
          />
          <datalist id="categoryList"></datalist>
          <div id="categorySuggestions" class="suggestions-container"></div>
          
          <label for="expenseQuantity">IloÅ›Ä‡:</label>
          <input 
            type="number" 
            id="expenseQuantity" 
            min="1" 
            value="1" 
            required
            aria-label="IloÅ›Ä‡"
            aria-required="true"
          />
          
          <label for="expenseAmount">Kwota (PLN):</label>
          <input 
            type="number" 
            id="expenseAmount" 
            min="0" 
            step="0.01" 
            required
            pattern="[0-9]+(\.[0-9]{1,2})?"
            aria-label="Kwota wydatku"
            aria-required="true"
          />
          
          <label for="expenseDesc">Opis:</label>
          <input 
            type="text" 
            id="expenseDesc" 
            placeholder="Np. zakupy spoÅ¼ywcze"
            aria-label="Opis wydatku"
          />
          <div id="descriptionSuggestions" class="suggestions-container"></div>
          
          <label for="expenseType">Typ:</label>
          <select id="expenseType" aria-label="Typ transakcji">
            <option value="normal">ZwykÅ‚y</option>
            <option value="planned">Planowany</option>
          </select>
          
          <button 
            type="submit"
            aria-label="Dodaj wydatek do budÅ¼etu"
          >
            â– Dodaj wydatek
          </button>
        </form>
      </section>

      <!-- Wykres kategorii -->
      <section id="category-chart" class="section">
        <h2>ğŸ“ˆ Wykres wydatkÃ³w wg kategorii</h2>
        <div class="category-controls">
          <label for="categoryMonthSelect">MiesiÄ…c:</label>
          <select id="categoryMonthSelect" aria-label="Wybierz miesiÄ…c">
            <option value="">Wszystkie</option>
          </select>
        </div>
        <div style="position: relative; height: 400px;">
          <canvas id="categoryChart"></canvas>
        </div>
        <div id="chartLegend" class="chart-legend"></div>
      </section>

      <!-- PorÃ³wnania -->
      <section id="comparisons" class="section">
        <h2>ğŸ“Š PorÃ³wnanie wydatkÃ³w w czasie</h2>
        <div class="comparison-controls" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:10px;">
          <label for="comparisonPeriod">Okres:</label>
          <select id="comparisonPeriod" aria-label="Wybierz okres porÃ³wnania">
            <option value="weekly">Tygodniowo (4 tyg.)</option>
            <option value="monthly">MiesiÄ™cznie (6 mies.)</option>
          </select>
        </div>
        <div style="height:400px;">
          <canvas id="comparisonsChart"></canvas>
        </div>
        <div id="comparisonsTable" style="overflow-x:auto;margin-top:15px;"></div>
      </section>

      <!-- Ustaw koÅ„ce okresu budÅ¼etowego -->
      <section id="set-end-date" class="section">
        <h2>ğŸ“† Okresy budÅ¼etowe</h2>
        <form id="endDatesForm">
          <label for="budgetEndDate1">Data koÅ„cowa 1:</label>
          <input 
            type="date" 
            id="budgetEndDate1" 
            required 
            disabled
            aria-label="Pierwsza data koÅ„cowa okresu budÅ¼etowego"
          />
          
          <label for="budgetEndDate2">Data koÅ„cowa 2:</label>
          <input 
            type="date" 
            id="budgetEndDate2" 
            required 
            disabled
            aria-label="Druga data koÅ„cowa okresu budÅ¼etowego"
          />
          
          <button 
            id="setEndDatesButton" 
            type="submit" 
            disabled
            aria-label="Ustaw daty koÅ„cowe okresÃ³w budÅ¼etowych"
          >
            ğŸ“… Ustaw daty koÅ„cowe
          </button>
        </form>
      </section>

      <!-- Ustaw cel oszczÄ™dnoÅ›ci -->
      <section id="saving-goal" class="section">
        <h2>ğŸ– Cel oszczÄ™dnoÅ›ci</h2>
        <form id="savingGoalForm">
          <label for="savingGoal">Kwota do oszczÄ™dzenia (PLN):</label>
          <input 
            type="number" 
            id="savingGoal" 
            min="0" 
            step="0.01"
            pattern="[0-9]+(\.[0-9]{1,2})?"
            aria-label="Kwota celu oszczÄ™dnoÅ›ci"
          />
          <button 
            type="submit"
            aria-label="Ustaw cel oszczÄ™dnoÅ›ci"
          >
            ğŸ’° Ustaw cel
          </button>
        </form>
      </section>

      <!-- Twoje kategorie -->
      <section id="categories" class="section">
        <h2>ğŸ“‚ ZarzÄ…dzaj kategoriami wydatkÃ³w</h2>
        <div id="categoriesSection">
          <div style="overflow-x: auto;">
            <table id="categoriesTable">
              <thead>
                <tr>
                  <th>Kategoria</th>
                  <th>Wydatki (PLN)</th>
                  <th>Edytuj</th>
                  <th>UsuÅ„</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Historia wydatkÃ³w -->
      <section id="expense-history" class="section">
        <h2>ğŸ§¾ Historia wszystkich wydatkÃ³w</h2>
        <div style="overflow-x: auto;">
          <table id="historyTable" class="history-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Godzina</th>
                <th>Kategoria</th>
                <th>Opis</th>
                <th>IloÅ›Ä‡</th>
                <th>Kwota (PLN)</th>
                <th>Edytuj</th>
                <th>UsuÅ„</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="expensePagination" class="pagination-controls"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer-info">
      <p>Autor: SÅ‚awomir Sprawski | Wersja 2.0</p>
    </footer>
  </div>

  <!-- GÅ‚Ã³wny skrypt aplikacji (moduÅ‚ ES6) -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>